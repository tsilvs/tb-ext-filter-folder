<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title data-i18n="extensionName">Loading...</title>
		<link rel="stylesheet" href="css/theme.css">
		<link rel="stylesheet" href="css/base.css">
		<link rel="stylesheet" href="css/layout.css">
		<link rel="stylesheet" href="css/cmp/_cards.css">
		<link rel="stylesheet" href="css/cmp/_tabs.css">
		<link rel="stylesheet" href="css/cmp/_buttons.css">
		<link rel="stylesheet" href="css/cmp/_forms.css">
		<link rel="stylesheet" href="css/cmp/_status.css">
		<link rel="stylesheet" href="css/cmp/_lists.css">
		<link rel="stylesheet" href="css/cmp/_modals.css">
		<link rel="stylesheet" href="css/cmp/_icons.css">
		<link rel="stylesheet" href="css/util/_misc.css">
		<link rel="stylesheet" href="css/util/_spacing.css">
	</head>

	<body>
		<main class="container">
			<header class="main-header">
				<h1 data-i18n="extensionName"></h1>

				<button id="btnSettings"
								class="icon-button"
								aria-label="Settings"
								title="Settings">
					<div class="icon icon-md icon-settings"></div>
				</button>
			</header>

			<!-- Shared Config -->
			<section class="card shared-config">
				<label for="account"
							 data-i18n="imapAccount"></label>
				<select id="account">
					<option data-i18n="loadingAccounts">Loading...</option>
				</select>

				<label for="fileInput"
							 data-i18n="uploadFile"></label>
				<input type="file"
							 id="fileInput"
							 accept=".dat,text/plain">

				<textarea id="pasteInput"
									class="collapsed"
									data-i18n-placeholder="pastePlaceholder"></textarea>

				<div class="meta-info">

					<div class="btn-group">

						<button id="btnSortInput"
										type="button"
										class="link-button"
										data-i18n="sortRulesBtn"></button>

						<span class="sep">•</span>

						<button id="btnApplyDefaults"
										type="button"
										class="link-button"
										data-i18n="applyDefaultsBtn"></button>
					</div>

					<span id="ruleCountDisplay"></span>
				</div>
			</section>

			<div class="tabs-container">
				<input type="radio"
							 name="tabs"
							 id="tabInputFolders"
							 checked>
				<input type="radio"
							 name="tabs"
							 id="tabInputDiscovery">
				<nav class="tabs-nav">
					<label for="tabInputFolders"
								 class="tab-label"
								 data-i18n="tabMissingFolders"></label>
					<label for="tabInputDiscovery"
								 class="tab-label"
								 data-i18n="tabRuleDiscovery"></label>
				</nav>

				<!-- Tab 1: Missing Folders -->

				<div class="tab-content"
						 id="contentFolders">
					<section class="card">
						<form id="formAnalyze">
							<section class="instruction"
											 data-i18n="instructions"></section>

							<div class="stats">
								<aside class="stat">

									<div class="stat-label"
											 data-i18n="totalFolders"></div>
									<output class="stat-value"
													id="statTotal">—</output>
								</aside>
								<aside class="stat">

									<div class="stat-label"
											 data-i18n="leafFolders"></div>
									<output class="stat-value"
													id="statLeafs">—</output>
								</aside>
								<aside class="stat">

									<div class="stat-label"
											 data-i18n="filterRules"></div>
									<output class="stat-value"
													id="statRules">—</output>
								</aside>
							</div>

							<div class="checkbox-group">
								<input type="checkbox"
											 id="mergeCase"
											 checked>
								<label for="mergeCase"
											 class="inline"
											 data-i18n="mergeCaseLabel"></label>
							</div>

							<div class="actions">

								<button type="submit"
												id="btnAnalyze"
												disabled
												data-i18n="analyzeMissing"></button>
								<aside class="status-area"
											 id="statusFolders"></aside>
							</div>
						</form>
					</section>

					<section id="analysisResults"
									 class="card">
						<h2 data-i18n="resultsHeader">Results</h2>

						<div class="stats">
							<aside class="stat">

								<div class="stat-label"
										 data-i18n="uniqueLeafs"></div>
								<output class="stat-value"
												id="resLeafs">—</output>
							</aside>
							<aside class="stat">

								<div class="stat-label"
										 data-i18n="missing"></div>
								<output class="stat-value"
												id="resMissing">—</output>
							</aside>
						</div>

						<div id="missingList"
								 class="folder-list empty-state">

							<span class="hint"
										data-i18n="analyzeToSeeFolders"></span>
						</div>

						<div class="actions">

							<button id="btnCreateMissing"
											disabled
											data-i18n="createMissingFoldersBtn"></button>
						</div>
					</section>
				</div>

				<!-- Tab 2: Discovery -->

				<div class="tab-content"
						 id="contentDiscovery">
					<section class="card">
						<form id="formDiscovery">
							<section class="instruction"
											 data-i18n="discoveryInstructions"></section>
							<label data-i18n="scanSourceLabel"></label>
							<select id="scanSource">
								<option data-i18n="loadingFolders"></option>
							</select>

							<label data-i18n="targetRootLabel"></label>

							<div class="input-group">
								<input type="text"
											 id="targetRoot">

								<button type="button"
												id="btnInfer"
												data-i18n="inferRootBtn"></button>
							</div>
							<small class="hint"
										 data-i18n="targetRootHint"></small>

							<div class="actions">

								<button type="submit"
												id="btnScan"
												class="primary"
												data-i18n="scanAndDiscover"></button>
								<aside class="status-area"
											 id="statusDiscovery"></aside>
							</div>
						</form>
					</section>

					<section id="discoveryResults"
									 class="card discovery-list hidden">

						<div class="list-header">
							<input type="checkbox"
										 id="selectAllDiscovery"
										 checked>

							<span class="sortable"
										data-sort="email">

								<span data-i18n="discoveredEmail"></span>

								<span class="sort-icon"></span></span>

							<span class="sortable"
										data-sort="path">

								<span data-i18n="proposedPath"></span>

								<span class="sort-icon"></span></span>
						</div>

						<div id="discoveryList"></div>

						<div class="actions">

							<button id="btnCreateDiscovered"
											disabled
											data-i18n="btnCreateFoldersOnly"></button>

							<button id="btnGenRules"
											class="secondary"
											disabled
											data-i18n="btnGenerateRulesOnly"></button>
						</div>
					</section>

					<section id="genRulesArea"
									 class="card hidden">
						<h3 data-i18n="generatedRulesHeader"></h3>

						<div id="accountMismatchWarning"
								 class="status warning"
								 style="display: none; margin-bottom: 12px;">
							<strong>⚠ Account Mismatch Detected</strong><br>
							Selected Account: <code id="mismatchAccountUri"></code><br>
							Rules Account: <code id="mismatchRulesUri"></code>
						</div>

						<fieldset id="ruleGenerationOptions">

							<div class="checkbox-group">
								<input type="checkbox"
											 id="chkOverrideAccount"
											 disabled
											 title="Enable when account mismatch is detected">
								<label for="chkOverrideAccount"
											 class="inline">
									Override with selected account URI
								</label>
							</div>
						</fieldset>

						<textarea id="genRulesOut"
											readonly></textarea>

						<div class="checkbox-group"
								 style="margin: 0 0 12px 0;">
							<input type="checkbox"
										 id="chkSortDownload"
										 checked>
							<label for="chkSortDownload"
										 class="inline"
										 data-i18n="sortCombinedLabel"></label>
						</div>

						<div class="actions">

							<button id="btnDownload"
											data-i18n="downloadCombined"></button>
						</div>
					</section>
				</div>
			</div>
		</main>

		<!-- Settings Modal -->

		<div id="settingsModal"
				 class="modal-overlay">

			<div class="modal-content">
				<header class="modal-header">
					<h2 data-i18n="settingsTitle">Settings</h2>

					<button id="btnCloseSettings"
									class="icon-button close">&times;</button>
				</header>
				<iframe src="options.html"
								class="settings-frame"></iframe>
			</div>
		</div>

		<script type="module"
						src="ui.js"></script>
	</body>

</html>
